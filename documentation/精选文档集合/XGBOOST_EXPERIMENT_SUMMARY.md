# XGBoost 实验总结报告

**运行ID**: `a2q41idg`  
**执行时间**: 2025-11-10 00:14:51 - 02:25:55 (约71分钟)  
**模型ID**: `xgboost_20251110_010814`  
**配置文件**: `configs/active/single_experiment/ml_strategy_config_new.yaml`

---

## 1. XGBoost 模型配置

### 1.1 核心超参数

| 参数 | 值 | 说明 |
|------|-----|------|
| `model_type` | xgboost | XGBoost回归模型 |
| `n_estimators` | 100 | 树的数量，平衡训练速度与性能 |
| `max_depth` | 3 | 树的最大深度，防止过拟合 |
| `learning_rate` | 0.05 | 学习率，中等强度 |
| `subsample` | 0.8 | 行采样比例，正则化 |
| `colsample_bytree` | 0.8 | 列采样比例，正则化 |
| `early_stopping_rounds` | 10 | 早停轮数 |
| `random_state` | 42 | 随机种子，保证可复现性 |

### 1.2 正则化参数

| 参数 | 值 | 说明 |
|------|-----|------|
| `reg_alpha` | 0.5 | L1正则化系数 |
| `reg_lambda` | 1.5 | L2正则化系数 |

### 1.3 超参数优化

- **状态**: 已禁用 (`enabled: false`)
- **原因**: 为了快速训练并与FF5实验进行受控对比
- **如果启用**: 将使用Optuna进行优化，目标为最大化Sharpe比率

---

## 2. 特征工程配置

### 2.1 启用的特征类型

- ✅ **动量特征** (Momentum)
- ✅ **波动率特征** (Volatility)
- ✅ **技术指标** (Technical)
- ✅ **成交量特征** (Volume)

### 2.2 特征参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 动量周期 | [21, 63, 252] | 不同时间窗口的动量指标 |
| 波动率窗口 | [20, 60] | 滚动波动率计算窗口 |
| 回望周期 | [20, 60, 252] | 特征计算的回望期 |
| 最小IC阈值 | 0.02 | 特征选择的信息系数阈值 |
| 特征滞后 | 1 | 特征滞后期（实际交易考虑） |
| Winsorize分位数 | 0.01 | 异常值处理 |

### 2.3 横截面特征

包含以下宏观经济和基本面特征：
- `market_cap` - 市值
- `book_to_market` - 账面市值比
- `size`, `value`, `momentum`, `volatility` - 因子特征
- `country_risk_premium` - 国家风险溢价
- `equity_risk_premium` - 股票风险溢价
- `default_spread` - 违约利差
- `corporate_tax_rate` - 企业税率

### 2.4 Box特征

- **启用**: ✅
- **维度**: 包含size、style、region、sector类别
- **编码方式**: One-hot编码
- **未知值处理**: 忽略

---

## 3. 训练数据配置

### 3.1 数据范围

| 参数 | 值 |
|------|-----|
| **训练期开始** | 2022-01-01 |
| **训练期结束** | 2023-12-31 |
| **回测期开始** | 2024-07-01 |
| **回测期结束** | 2025-08-15 |
| **数据集日期范围** | 2023-10-23 至 2025-08-15 |

### 3.2 股票池

| 指标 | 值 |
|------|-----|
| 交易股票数量 | 136 |
| 训练股票数量 | 180 |
| 数据集总数据点 | 45,152 |
| 平均每只股票数据点 | 332 |
| 最小市值要求 | $1B |

### 3.3 数据质量

- **数据提供者**: YFinanceProvider
- **缓存启用**: ✅
- **重试机制**: 最多3次，延迟1秒

---

## 4. 组合构建策略

### 4.1 组合构建方法

- **方法**: Box-Based Portfolio Construction
- **与FF5对比**: 使用相同配置以确保受控对比

### 4.2 Box配置

- **目标Box数量**: 18 (3 size × 3 style × 2 region)
- **实际覆盖Box数量**: 9 (仅发达市场，未覆盖新兴市场)
- **Box覆盖率**: 50%
- **Box权重方法**: 等权重分配

### 4.3 权重分配

| 参数 | 值 |
|------|-----|
| 分配方法 | Mean-Variance Optimization |
| 分配范围 | Global (全局优化) |
| 风险厌恶系数 | 2.0 |
| 回望天数 | 252 |
| 协方差估计方法 | Ledoit-Wolf收缩 |

### 4.4 约束条件

| 约束 | 值 |
|------|-----|
| 最大单股权重 | 50% |
| 最大杠杆 | 1.0 |
| 最小单股权重 | 1% |
| 允许做空 | ❌ |
| 持仓限制 | 99% |

---

## 5. 回测配置

### 5.1 交易设置

| 参数 | 值 |
|------|-----|
| 初始资金 | $1,000,000 |
| 手续费率 | 0.1% |
| 滑点率 | 0.05% |
| 点差 | 0.05% |
| 总成本率 | 0.2% |
| 再平衡频率 | 每周 |
| 再平衡阈值 | 0.1% |

### 5.2 风险管理

- **最大回撤限制**: 无
- **波动率限制**: 无
- **风险无风险利率**: 2.00%

---

## 6. 回测结果

### 6.1 核心收益指标

| 指标 | 值 | 评估 |
|------|-----|------|
| **总收益率** | -39.61% | ❌ 亏损严重 |
| **年化收益率** | -35.10% | ❌ 表现较差 |
| **基准收益率** | 18.22% | ✅ 基准表现良好 |
| **Alpha** | -34.52% | ❌ 显著负Alpha |
| **最终组合价值** | $603,860 | ❌ 大幅低于初始资金 |

### 6.2 风险调整收益

| 指标 | 值 | 评估 |
|------|-----|------|
| **Sharpe比率** | -0.545 | ❌ 负值，风险调整后收益差 |
| **Sortino比率** | -0.416 | ❌ 下行风险调整后收益差 |
| **Calmar比率** | -0.608 | ❌ 回撤调整后收益差 |
| **信息比率** | -0.797 | ❌ 相对基准表现差 |

### 6.3 风险指标

| 指标 | 值 | 评估 |
|------|-----|------|
| **波动率** | 52.24% | ⚠️ 波动率较高 |
| **最大回撤** | -57.75% | ❌ 回撤严重 |
| **平均回撤** | -41.78% | ❌ 平均回撤较大 |
| **回撤频率** | 98.98% | ❌ 几乎持续处于回撤状态 |
| **下行波动率** | 68.95% | ❌ 下行波动率很高 |
| **跟踪误差** | 52.52% | ⚠️ 与基准偏离较大 |

### 6.4 风险度量（VaR & ES）

| 指标 | 值 |
|------|-----|
| VaR (95%) | -1.71% |
| VaR (99%) | -6.62% |
| Expected Shortfall (95%) | -7.52% |
| Expected Shortfall (99%) | -26.16% |

### 6.5 基准相关性

| 指标 | 值 | 说明 |
|------|-----|------|
| **Beta** | 0.451 | 低于市场，但Alpha为负 |
| **Up Capture** | -6.10% | 市场上涨时未能捕捉收益 |
| **Down Capture** | 31.99% | 市场下跌时亏损相对较小 |

### 6.6 交易统计

| 指标 | 值 |
|------|-----|
| **胜率** | 56.80% | 超过一半交易盈利，但整体亏损 |
| **盈亏比** | 0.823 | 平均亏损大于平均盈利 |

### 6.7 组合特征

| 指标 | 值 |
|------|-----|
| **平均持仓数量** | 29.4 |
| **持仓数量范围** | 15 - 39 |
| **平均单股权重** | 3.89% |
| **最大单股权重** | 34.87% |
| **平均集中度** | 25.11% |
| **HHI集中度指数** | 0.134 |
| **组合换手率** | 2.09% |
| **信号换手率** | 4.17% |

### 6.8 信号质量

| 指标 | 值 |
|------|-----|
| **平均信号强度** | 0.735% |
| **最大信号强度** | 10.92% |
| **信号频率** | 0.368% |
| **信号变化总数** | 205 |
| **平均信号一致性** | 1.0 |

### 6.9 主要贡献股票

#### 正向贡献 (Top 5)

| 股票代码 | 贡献度 |
|---------|--------|
| AAF.L | 8.78% |
| ORNBV.HE | 5.43% |
| 9532.T | 5.29% |
| RBI.VI | 4.17% |
| DBK.DE | 3.75% |

#### 负向贡献 (Bottom 5)

| 股票代码 | 贡献度 |
|---------|--------|
| TXRH | -1.33% |
| CMCSA | -0.99% |
| 600519.SS | -0.62% |
| MSFT | -0.43% |
| ATI | -0.39% |

---

## 7. 实验执行信息

### 7.1 系统环境

| 项目 | 值 |
|------|-----|
| **操作系统** | macOS 15.6.1 (ARM64) |
| **Python版本** | 3.11.9 |
| **CPU** | Apple M1 Pro (2 E-cores + 6 P-cores) |
| **内存** | 16 GB |
| **运行时间** | 4,262秒 (约71分钟) |

### 7.2 Git信息

| 项目 | 值 |
|------|-----|
| **仓库** | https://github.com/wenjiaqi8255/bloomberg-competition-2025.git |
| **提交** | 86bfdd0e1e577a690e1336b7eaa2c6df1d8ff080 |

---

## 8. 结果分析

### 8.1 主要问题

1. **严重亏损**: 总收益率为-39.61%，远低于基准的18.22%
2. **负Alpha**: Alpha为-34.52%，说明模型未能产生超额收益
3. **高波动率**: 52.24%的波动率显示组合风险较高
4. **大幅回撤**: 最大回撤达-57.75%，且回撤频率接近99%
5. **Up Capture为负**: -6.10%的上升捕获率表明市场上涨时未能获益

### 8.2 可能原因

1. **模型预测能力不足**: XGBoost可能在当前市场环境下未能有效捕捉收益信号
2. **特征工程不足**: 可能需要更有效的特征或特征选择方法
3. **过拟合风险**: 尽管使用了正则化，但模型可能仍然过拟合训练数据
4. **市场环境**: 2024-2025年的市场环境可能与训练期(2022-2023)有显著差异
5. **组合构建**: Box-Based方法可能限制了组合的灵活性

### 8.3 亮点

1. **胜率尚可**: 56.80%的胜率显示模型有一定预测能力
2. **风险控制**: Down Capture为31.99%，在下跌市场中损失相对可控
3. **信号稳定性**: 平均信号一致性为1.0，信号相对稳定

---

## 9. 改进建议

### 9.1 模型层面

1. **启用超参数优化**: 使用Optuna进行系统化的超参数调优
2. **尝试不同模型**: 考虑LSTM或其他时间序列模型
3. **集成学习**: 尝试模型集成以提高稳定性
4. **特征选择**: 使用更严格的IC阈值或特征重要性分析

### 9.2 特征工程

1. **扩展特征集**: 添加更多宏观经济和技术指标
2. **时序特征**: 增强时间序列特征的构建
3. **交互特征**: 考虑特征间的交互作用

### 9.3 组合构建

1. **优化权重分配**: 调整风险厌恶系数或尝试其他分配方法
2. **动态调整**: 根据市场环境动态调整组合配置
3. **风险限制**: 设置更严格的风险限制（最大回撤、波动率）

### 9.4 策略层面

1. **市场择时**: 加入市场状态判断机制
2. **止损机制**: 实现动态止损以控制回撤
3. **仓位管理**: 根据信号强度动态调整仓位

---

## 10. 文件参考

本实验的相关文件位置：

- **配置文件**: `configs/active/single_experiment/ml_strategy_config_new.yaml`
- **模型目录**: `models/xgboost_20251110_010814/`
- **回测结果**: `results/xgboost_20251110_010814/strategy_returns.csv`
- **WandB运行**: `wandb/run-20251110_011451-a2q41idg/`

---

**报告生成时间**: 2025-11-10  
**报告生成工具**: 基于WandB实验数据的自动分析
